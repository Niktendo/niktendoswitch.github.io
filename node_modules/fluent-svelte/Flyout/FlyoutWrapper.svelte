<script >import { createEventDispatcher } from "svelte";
import { uid, focusTrap } from "../internal";
import FlyoutSurface from "./FlyoutSurface.svelte";
/** Determines the flyout's visibility. */
export let open = false;
/** Determines if the flyout can be closed using conventional user interaction. */
export let closable = true;
/** Direction that the flyout will be opened from. */
export let placement = "top";
/** Alignment of the menu along the clickable target's given axis. */
export let alignment = "center";
/** Distance of the flyout from the control button in pixels. */
export let offset = 4;
/** Specifies a custom class name for the flyout. */
let className = "";
export { className as class };
/** Obtains a bound DOM reference to the content wrapper element. */
export let wrapperElement = null;
/** Obtains a bound DOM reference to the menu's positioning anchor element. */
export let anchorElement = null;
/** Obtains a bound DOM reference to the inner menu element. */
export let menuElement = null;
/** Obtains a bound DOM reference to the menu backdrop, which is present while the menu is `open`. */
export let backdropElement = null;
const dispatch = createEventDispatcher();
const menuId = uid("fds-flyout-anchor-");
$: dispatch(open ? "open" : "close");
function handleEscapeKey({ key }) {
    if (key === "Escape" && closable)
        open = false;
}
function closeFlyout() {
    if (closable)
        open = false;
}
</script>

<svelte:window on:keydown={handleEscapeKey} />

<div
	class="flyout-wrapper"
	aria-expanded={open}
	aria-haspopup={open}
	aria-controls={menuId}
	on:click={() => (open = !open)}
	bind:this={wrapperElement}
>
	<slot />
	{#if open}
		<slot name="override">
			<div
				id={menuId}
				class="flyout-anchor placement-{placement} alignment-{alignment}"
				style="--fds-flyout-offset: {offset}px;"
				use:focusTrap
				bind:this={anchorElement}
				on:click={e => e.stopPropagation()}
			>
				<FlyoutSurface bind:element={menuElement} class={className ?? ""} {...$$restProps}>
					<slot name="flyout" />
				</FlyoutSurface>
			</div>
			<div class="flyout-backdrop" bind:this={backdropElement} on:mousedown={closeFlyout} />
		</slot>
	{/if}
</div>

<style >.flyout-wrapper{display:inline-block;height:auto;position:relative}.flyout-backdrop{height:100%;left:0;position:fixed;top:0;width:100%;z-index:9999}.flyout-anchor{position:absolute;z-index:10000}.flyout-anchor.placement-top{--fds-flyout-transition-offset:translateY(12px);bottom:calc(100% + var(--fds-flyout-offset))}.flyout-anchor.placement-bottom{--fds-flyout-transition-offset:translateY(-12px);top:calc(100% + var(--fds-flyout-offset))}.flyout-anchor.placement-left{--fds-flyout-transition-offset:translateX(12px);right:calc(100% + var(--fds-flyout-offset))}.flyout-anchor.placement-right{--fds-flyout-transition-offset:translateX(-12px);left:calc(100% + var(--fds-flyout-offset))}.flyout-anchor.placement-bottom.alignment-start,.flyout-anchor.placement-top.alignment-start{inset-inline-start:0}.flyout-anchor.placement-bottom.alignment-end,.flyout-anchor.placement-top.alignment-end{inset-inline-end:0}.flyout-anchor.placement-bottom.alignment-center,.flyout-anchor.placement-top.alignment-center{inset-inline-start:50%;transform:translateX(-50%)}.flyout-anchor.placement-left.alignment-start,.flyout-anchor.placement-right.alignment-start{inset-block-start:0}.flyout-anchor.placement-left.alignment-end,.flyout-anchor.placement-right.alignment-end{inset-block-end:0}.flyout-anchor.placement-left.alignment-center,.flyout-anchor.placement-right.alignment-center{inset-block-start:50%;transform:translateY(-50%)}</style>
