"use strict";
exports.__esModule = true;
exports.parseExports = void 0;
var acorn = require("acorn");
function parseExports(source) {
    var ast = acorn.parse(source, {
        ecmaVersion: "latest",
        sourceType: "module"
    });
    var exports_by_identifier = {};
    // @ts-ignore
    ast.body.forEach(function (node) {
        var _a, _b, _c, _d;
        if (node.type === "ExportDefaultDeclaration") {
            var id = node.declaration.name;
            if (id in exports_by_identifier) {
                exports_by_identifier[id]["default"] = true;
            }
            else {
                exports_by_identifier[id] = { source: "", "default": true };
            }
        }
        if (node.type === "ExportNamedDeclaration") {
            node.specifiers.forEach(function (specifier) {
                var _a, _b, _c, _d;
                var exported_name = specifier.exported.name;
                var id = exported_name || specifier.local.name;
                if (id in exports_by_identifier) {
                    if (node.type === "ExportNamedDeclaration") {
                        exports_by_identifier[id].mixed = true;
                    }
                    if (!exports_by_identifier[id].source) {
                        exports_by_identifier[id].source = (_b = (_a = node.source) === null || _a === void 0 ? void 0 : _a.value) !== null && _b !== void 0 ? _b : "";
                    }
                }
                else {
                    exports_by_identifier[id] = {
                        source: (_d = (_c = node.source) === null || _c === void 0 ? void 0 : _c.value) !== null && _d !== void 0 ? _d : "",
                        "default": id === "default"
                    };
                }
            });
        }
        else if (node.type === "ImportDeclaration") {
            var id = node.specifiers[0].local.name;
            if (id in exports_by_identifier) {
                if (!exports_by_identifier[id].source) {
                    exports_by_identifier[id].source = (_b = (_a = node.source) === null || _a === void 0 ? void 0 : _a.value) !== null && _b !== void 0 ? _b : "";
                }
            }
            else {
                exports_by_identifier[id] = {
                    source: (_d = (_c = node.source) === null || _c === void 0 ? void 0 : _c.value) !== null && _d !== void 0 ? _d : "",
                    "default": id === "default"
                };
            }
        }
    });
    return exports_by_identifier;
}
exports.parseExports = parseExports;
